<!DOCTYPE html>
<html>
    <head lang="en">
        <title>Increment Counter Settings</title>
        <meta charset="utf-8" />
        <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
    </head>
    <style>
        #errorWrapper {
            display: none;
            border: 2px red solid;
        }
        p {
            font-family: Arial, Helvetica, sans-serif;
            color: #fff;
            text-align: center;
            font-size: 14px;
        }
    </style>
    <body>
        <!--
      Learn more about property inspector components at https://sdpi-components.dev/docs/components
      -->
        <sdpi-item label="Unit">
            <sdpi-select setting="unit" default="mgdl">
                <option value="mgdl">mgDl</option>
                <option value="mmol">mmol</option>
            </sdpi-select>
        </sdpi-item>
        <sdpi-item>
            <h4>Auth</h4>
        </sdpi-item>
        <!-- <sdpi-headi label="Error">
            <sdpi-textfield id="error" setting="error" default="" disabled> </sdpi-textfield>
        </sdpi-headi> -->
        <sdpi-item id="errorWrapper" label="Error">
            <sdpi-textfield id="error" setting="error" default="" disabled> </sdpi-textfield>
        </sdpi-item>
        <sdpi-item label="E-mail">
            <sdpi-textfield id="email" setting="email" default=""> </sdpi-textfield>
        </sdpi-item>
        <sdpi-item label="Password">
            <sdpi-password id="password" setting="password" default=""> </sdpi-password>
        </sdpi-item>
        <sdpi-item>
            <sdpi-button id="loginButton">Login</sdpi-button>
        </sdpi-item>

        <script>
            const { streamDeckClient } = SDPIComponents;

            const errorWrapper = document.querySelector('#errorWrapper');
            const error = document.querySelector('#error');

            streamDeckClient.didReceiveSettings.subscribe((e) => {
                if (typeof e.payload.settings.error === 'string' && e.payload.settings?.error !== '') {
                    errorWrapper.style.display = 'block';
                } else {
                    errorWrapper.style.display = 'none';
                }
            });

            const loginButton = document.querySelector('#loginButton');

            loginButton.addEventListener('click', (e) => {
                streamDeckClient.getSettings().then((e) => {
                    const settings = e.settings;
                    settings.type = 'login';
                    streamDeckClient.setSettings(settings);
                    console.log(settings);
                });
            });
        </script>
    </body>
</html>
